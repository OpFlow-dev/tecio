#include "SZLFEPartitionedZoneHeaderWriter.h"
#include "ThirdPartyHeadersBegin.h"
#include <boost/assign.hpp>
#include "ThirdPartyHeadersEnd.h"
#include "AltTecUtil.h"
#include "ItemSetIterator.h"
#include "writeValueArray.h"
namespace tecplot { namespace ___3934 { SZLFEPartitionedZoneHeaderWriter::SZLFEPartitionedZoneHeaderWriter( uint32_t                             fileVersion, ItemSetIterator&                     varIter, ___4636                          zone, ___4636                          ___341, ___37&                          ___36, ___2241<int32_t> const&    partitionFileNums, UInt64Array const&                   partitionHeaderFilePositions, ___2241<Int64Array> const& secPtnNumCells, Int64Array const&                    partitionNumNodes, VarZoneMinMaxArray const&            varPartitionMinMaxes) : ZoneHeaderWriterAbstract(fileVersion, varIter, zone, ___341, ___36) , m_partitionFileNums(partitionFileNums) , m_partitionHeaderFilePositions(partitionHeaderFilePositions) , m_secPtnNumCells(secPtnNumCells) , m_partitionNumNodes(partitionNumNodes) , m_varPartitionMinMaxes(varPartitionMinMaxes) {} SZLFEPartitionedZoneHeaderWriter::~SZLFEPartitionedZoneHeaderWriter() {} uint64_t SZLFEPartitionedZoneHeaderWriter::sizeInFile(bool ___2001) const { uint64_t ___3359 = zoneHeaderTagsSizeInFile(6, ___2001); size_t numPartitions = static_cast<size_t>(___2338.zoneGetNumPartitions(___2678 + 1)); ___4265 const datasetID = ___2338.datasetGetUniqueID(); ___1170 numSections = 1; if (___2338.___4620(___2678 + 1) == ZoneType_FEMixed) { if (!___2338.zoneGetNumSections(datasetID, ___2678 + 1, &numSections)) throw std::runtime_error("failed to get zone section information"); } ___3359 += arraySizeInFile<int32_t, false>(numPartitions, ___2001); if (m_fileVersion < 232) { ___3359 += arraySizeInFile<uint32_t, false>(numSections*numPartitions, ___2001); ___3359 += arraySizeInFile<uint32_t, false>(numPartitions, ___2001); } else { ___3359 += arraySizeInFile<int64_t, false>(numSections*numPartitions, ___2001); ___3359 += arraySizeInFile<int64_t, false>(numPartitions, ___2001); } ___3359 += arraySizeInFile<uint64_t, true /* ___2024 */>(numPartitions, ___2001); m_varIter.reset(); while (m_varIter.hasNext()) { ___4352 const datasetVar = m_varIter.next(); FieldDataType_e ___1361 = const_cast<___37&>(___2338).___921(___2678 + 1, datasetVar + 1); switch (___1361) { case FieldDataType_Float: ___3359 += arraySizeInFile<std::pair<float, float>, false >(numPartitions, ___2001); break; case FieldDataType_Double: ___3359 += arraySizeInFile<std::pair<double, double>, false >(numPartitions, ___2001); break; case FieldDataType_Int32: ___3359 += arraySizeInFile<std::pair<int32_t, int32_t>, false >(numPartitions, ___2001); break; case FieldDataType_Int16: ___3359 += arraySizeInFile<std::pair<int16_t, int16_t>, false >(numPartitions, ___2001); break; case FieldDataType_Byte: case ___1363: ___3359 += arraySizeInFile<std::pair<uint8_t, uint8_t>, false >(numPartitions, ___2001); break; default: ___476(___1303); break; } } return ___3359; } ___372 SZLFEPartitionedZoneHeaderWriter::write(FileWriterInterface& fileWriter) const
{ REQUIRE(fileWriter.___2040()); ___4636 numPartitions = ___2338.zoneGetNumPartitions(___2678 + 1); ___372 ___2038 = ___4227; try { ___3946 ___3945 = boost::assign::map_list_of<uint16_t, uint64_t> (NUM_PARTITIONS_TAG, uint64_t(numPartitions)) (PARTITION_FILE_NUM_TAG, ___330) (PARTITION_FILE_LOC_TAG, ___330) (PARTITION_NUM_CELLS_TAG, ___330) (PARTITION_NUM_NODES_TAG, ___330) (VAR_PARTITION_MIN_MAX_TAG, ___330); ___1391 headerFileLoc = fileWriter.fileLoc(); ___2038 = ___4565(fileWriter, ___3945); ___4636 const fileZone = ___2678 - m_baseZone; if (___2038) { ___3945[PARTITION_FILE_NUM_TAG] = fileWriter.fileLoc(); ___2038 = ___4563<int32_t, false, 0>(fileWriter, appendZoneSuffix(PARTITION_FILE_NUM_DESCRIPTION).c_str(), fileZone, numPartitions, m_partitionFileNums.data()); } if (___2038) { ___3945[PARTITION_FILE_LOC_TAG] = fileWriter.fileLoc(); ___2038 = ___4563<uint64_t, true, 0>(fileWriter, appendZoneSuffix(PARTITION_FILE_LOC_DESCRIPTION).c_str(), fileZone, numPartitions, m_partitionHeaderFilePositions.data()); } if (___2038) { ___4265 const datasetID = ___2338.datasetGetUniqueID(); ___1170 numSections = 1; if (___2338.___4620(___2678 + 1) == ZoneType_FEMixed) { if (!___2338.zoneGetNumSections(datasetID, ___2678 + 1, &numSections)) throw std::runtime_error("failed to get zone section information"); } ___3945[PARTITION_NUM_CELLS_TAG] = fileWriter.fileLoc(); if (m_fileVersion < 232) { ___2241<___2241<uint32_t> > secPtnNumCells_uint32; ___2038 = secPtnNumCells_uint32.alloc(numSections); for (___1170 section = 0; ___2038 && section < numSections; ++section) { ___2038 = secPtnNumCells_uint32[section].alloc(numPartitions); for (___4636 ptn = 0; ___2038 && ptn < numPartitions; ++ptn) secPtnNumCells_uint32[section][ptn] = checked_numeric_cast<uint32_t>(m_secPtnNumCells[section][ptn]); ___2038 = ___4563<uint32_t, false, 0>(fileWriter, appendZoneSuffix(PARTITION_NUM_CELLS_DESCRIPTION).c_str(), fileZone, numPartitions, secPtnNumCells_uint32[section].data()); } } else { for (___1170 section = 0; ___2038 && section < numSections; ++section) { ___2038 = ___4563<int64_t, false, 0>(fileWriter, appendZoneSuffix(PARTITION_NUM_CELLS_DESCRIPTION).c_str(), fileZone, numPartitions, m_secPtnNumCells[section].data()); } } } if (___2038) { ___3945[PARTITION_NUM_NODES_TAG] = fileWriter.fileLoc(); if (m_fileVersion < 232) { ___2241<uint32_t> partitionNumNodes_uint32; ___2038 = partitionNumNodes_uint32.alloc(numPartitions); for (___4636 ptn = 0; ___2038 && ptn < numPartitions; ++ptn) partitionNumNodes_uint32[ptn] = checked_numeric_cast<uint32_t>(m_partitionNumNodes[ptn]); ___2038 = ___4563<uint32_t, false, 0>(fileWriter, appendZoneSuffix(PARTITION_NUM_NODES_DESCRIPTION).c_str(), fileZone, numPartitions, partitionNumNodes_uint32.data()); } else { ___2038 = ___4563<int64_t, false, 0>(fileWriter, appendZoneSuffix(PARTITION_NUM_NODES_DESCRIPTION).c_str(),
fileZone, numPartitions, m_partitionNumNodes.data()); } } if (___2038) { ___3945[VAR_PARTITION_MIN_MAX_TAG] = fileWriter.fileLoc(); m_varIter.reset(); ___4352 const baseVar = m_varIter.baseItem(); while (___2038 && m_varIter.hasNext()) { ___4352 const datasetVar = m_varIter.next(); ___4352 const fileVar = datasetVar - baseVar; FieldDataType_e ___1361 = const_cast<___37&>(___2338).___921(___2678 + 1, datasetVar + 1); switch (___1361) { case FieldDataType_Float: ___2038 = ___2038 && ___4528<float>(fileWriter, VAR_PARTITION_MIN_MAX_DESCRIPTION "ForVar", fileVar, numPartitions, &m_varPartitionMinMaxes[fileVar][0], ___944 / 2); break; case FieldDataType_Double: ___2038 = ___2038 && ___4528<double>(fileWriter, VAR_PARTITION_MIN_MAX_DESCRIPTION "ForVar", fileVar, numPartitions, &m_varPartitionMinMaxes[fileVar][0], ___944 / 2); break; case FieldDataType_Int32: ___2038 = ___2038 && ___4528<int32_t>(fileWriter, VAR_PARTITION_MIN_MAX_DESCRIPTION "ForVar", fileVar, numPartitions, &m_varPartitionMinMaxes[fileVar][0], ___944 / 2); break; case FieldDataType_Int16: ___2038 = ___2038 && ___4528<int16_t>(fileWriter, VAR_PARTITION_MIN_MAX_DESCRIPTION "ForVar", fileVar, numPartitions, &m_varPartitionMinMaxes[fileVar][0], ___944 / 2); break; case FieldDataType_Byte: case ___1363: ___2038 = ___2038 && ___4528<uint8_t>(fileWriter, VAR_PARTITION_MIN_MAX_DESCRIPTION "ForVar", fileVar, numPartitions, &m_varPartitionMinMaxes[fileVar][0], ___944 / 2); break; default: ___476(___1303); break; } } } ___1391 endFileLoc = fileWriter.fileLoc(); ___2038 = ___2038 && fileWriter.___3460(headerFileLoc) && ___4565(fileWriter, ___3945) && fileWriter.___3460(endFileLoc); } catch(std::bad_alloc const&) { ___2038 = ___1184("Out of memory while writing zone %d header.", ___2678 + 1); } catch(...) { ___2038 = ___1184("Unrecoverable error while writing zone %d header.", ___2678 + 1); } return ___4227; } }}
