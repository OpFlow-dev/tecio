#include "stdafx.h"
#include "MASTER.h"
 #define ___855
#include "GLOBAL.h"
#include "CodeContract.h"
#include "Q_UNICODE.h"
#include "TranslatedString.h"
#include "TecplotVersion.h"
#include "Version.h"
 #if defined MSWIN
 #pragma warning (disable : 4244)
 #endif
static ___1630 TempGeom; static ___4119 TempText; using namespace tecplot;
#include "DATASET0.h"
#include "SET.h"
#include "FILESTREAM.h"
#include "DATAIO.h"
#include "DATAIO4.h"
#include "STRUTIL.h"
#include "AUXDATA.h"
#include "ARRLIST.h"
#include "STRLIST.h"
#include "ALLOC.h"
#include "DATASET.h"
#include "SYSTEM.h"
#include "Q_MSG.h"
#include "FileSystem.h"
namespace { ___372 validZoneMarker( double zoneMarker, short pltVersion) { ___372 ___3359 = ___1303; if (zoneMarker == ZoneMarkerFull32Bit) ___3359 = ___4227; else if (pltVersion >= 191 && zoneMarker == ZoneMarkerFace64Bit) ___3359 = ___4227; ENSURE(VALID_BOOLEAN(___3359)); return ___3359; } short getZoneVersion(short fileVersion, double zoneMarker) { REQUIRE(zoneMarker == ZoneMarkerFull32Bit || zoneMarker == ZoneMarkerFace64Bit); short zoneVersion = fileVersion; ___476(fileVersion <= 191); if (fileVersion >= 191) { if (zoneMarker == ZoneMarkerFull32Bit) zoneVersion = 112; } return zoneVersion; } } ___372 ___3280(___1403    *___1399, short            fileVersion, ___372        ASSERT_ONLY(___3569), ___1170      *___2848, ___1170      *NumVars, int32_t         *___2793, char           **___901, ___4119         **___340, ___1630         **___336, ___3840  **___789, ___3840   *___4286, ___264      *___884, ___90       ___263, ___3502         **___2074, ___372       *___1820, ___372       *___1819, ___134    *___4682, ___3840   *___4366, ___134    *___4338, ___3502          *___2052, ___2226      **___1439, DataFileType_e  *___1406) { ___372    ___2039 = ___4227; ___372    SentError = ___1303; double       ___4567=0; int          Pass; ___1396 InitialFilePosition; REQUIRE(VALID_REF(___1399) && VALID_REF(___1399->File)); REQUIRE(fileVersion > 0); REQUIRE(VALID_BOOLEAN(___3569)); REQUIRE(VALID_REF(___2848)); REQUIRE(VALID_REF(NumVars)); REQUIRE(VALID_REF(___901)       || (___901 == NULL)); REQUIRE(VALID_REF(___340)           || (___340 == NULL)); REQUIRE(VALID_REF(___336)           || (___336 == NULL)); REQUIRE(VALID_REF(___1820)            || (___1820 == NULL)); REQUIRE(VALID_REF(___1819)           || (___1819 == NULL)); REQUIRE(VALID_REF(___4682)       || (___4682 == NULL)); REQUIRE(VALID_REF(___4366)           || (___4366 == NULL)); REQUIRE(VALID_REF(___2793) || (___2793 == NULL)); REQUIRE(VALID_REF(___4286)            || (___4286 == NULL)); REQUIRE((VALID_REF(___884) && (VALID_REF(*___884) || *___884 == NULL)) || ___884 == NULL); REQUIRE((VALID_REF(___4338) && (VALID_REF(*___4338) || *___4338 == NULL)) || ___4338 == NULL); REQUIRE(VALID_REF(___2074)  || (___2074 == NULL)); REQUIRE((VALID_REF(___789) && VALID_REF(___2793)) || (___789 == NULL)); REQUIRE(VALID_REF(___2052) || (___2052 == NULL)); REQUIRE(VALID_REF(___1439)  || (___1439 == NULL)); REQUIRE(VALID_REF(___1406)         || (___1406 == NULL));
 #if !defined TECPLOTKERNEL
___2226 const maxTextLength = 200; TempText.Text = "";
 #else
___2226 const maxTextLength = ___1545.___2242.MaxChrsInTextLabels;
 #endif
if (___901) *___901 = NULL; if (___340) *___340 = NULL; if (___336) *___336 = NULL; if (___1820) *___1820 = ___1303; if (___1819) *___1819 = ___1303; if (___4682) *___4682 = NULL; if (___4366) *___4366 = NULL; if (___2793) *___2793 = 0; if (___789) *___789 = NULL; if (___884 != NULL) { ___476(VALID_REF(*___884) || *___884 == NULL); } if (___4338 != NULL) { ___476(VALID_REF(*___4338) || *___4338 == NULL); } if (___4286) *___4286 = NULL; if (___2074) *___2074 = NULL; if (___2052) *___2052 = NULL; if (___1439) *___1439 = NULL; if (___1406) *___1406 = ___843; InitialFilePosition = ___4202(___1399->File); for (Pass = 1; ___2039 && (Pass <= 2); Pass++) { if (Pass == 2) { if (___4201(___1399->File, InitialFilePosition, SEEK_SET) != 0) ___2039 = ___1303; if (___2039 && (*___2848 > 0 && ___4682 != NULL && *___4682 == NULL)) { *___4682 = ArrayListAlloc(*___2848, ArrayListType_VoidPtr, ___4668, 0); ___2039 = (*___4682 != NULL); } if (___2039 && (___789 != NULL    && *___789 == NULL && *___2793 > 0)) { *___789 = ___23(*___2793, ___3840, "CustomLabel Sets"); ___2039 = (*___789 != NULL); if (___2039) { int32_t N; for (N = 0; N < *___2793; N++) (*___789)[N] = NULL; } } if (___2039 && (___4286 != NULL && *___4286 == NULL)) { *___4286 = ___3822(); ___2039 = (___372)(*___4286 != NULL); } if (___2039 && (___884 != NULL && *___884 == NULL)) { *___884 = ___231(___263); ___2039 = (___372)(*___884 != NULL); } if (___2039 && (___4338 != NULL && *___4338 == NULL) && *NumVars > 0) { *___4338 = ArrayListAlloc(0, ArrayListType_VoidPtr, ___4668, 0); ___2039 = (*___4338 != NULL && ___170(*___4338, *NumVars - 1, NULL)); } if (___2039            && (*___2848 > 0) && (___2074 != NULL) && (*___2074 == NULL)) { *___2074 = ___23(*___2848, ___3502, "Array of IsVarCellCentered sets"); if (*___2074) { ___1170 Z; for (Z = 0; ___2039 && (Z < *___2848); Z++) { (*___2074)[Z] = ___29(___1303); ___2039 = (___372)((*___2074)[Z] != NULL); } } else ___2039 = ___1303; } if (___2039 && *___2848 > 0 && ___2052 != NULL) { *___2052 = ___29(___1303); ___2039 = (*___2052 != NULL); } if (___2039 && *___2848 > 0 && ___1439 != NULL) { *___1439 = ___23(*___2848, ___2226, "Array of FNNumBndryConns"); ___2039 = (*___1439 != NULL); if (___2039) for (___2226 i = 0; i < *___2848; i++) (*___1439)[i] = 0; } } if (___2793 != NULL) *___2793 = 0; *___2848 = 0; *NumVars  = 0; if (___2039) { char *S = NULL; int  INumVars; ___2039 = ___3288(___1399,
fileVersion, ((Pass == 2) ? &S : (char **)NULL), ((Pass == 2) ? ___1406 : (DataFileType_e *)NULL), &INumVars, ((Pass == 2) ? ___4366 : (___3840 *)NULL)); if (___2039) *NumVars = (___1170)INumVars; if ((Pass == 2) && S && ___2039 && ___901) *___901 = S; else if (S != NULL) ___1528(S, "data set title"); } if (___2039) { if (___2039) ___4567 = ___1761(___1399, FieldDataType_Float, 0.0, 1000.0, &___2039); while (___2039 && (___4567 != EndHeaderMarker)) { if (validZoneMarker(___4567, fileVersion)) { short const zoneVersion = getZoneVersion(fileVersion, ___4567); ___4683* ___4677 = new ___4683(___4704); ___372 ___2869 = (Pass == 2 && ___2074 != NULL); TecplotFileZoneFormat fileZoneFormat( ___1399->___2006 == ___4227, fileVersion, zoneVersion); ___372 LocalIsRawFNAvailable; ___2226 LocalFNNumBndryConns; ___2039 = ___3296(___1399, fileZoneFormat, *___4677, ___2869 ? (*___2074)[*___2848] : NULL, *NumVars, ___263, &LocalIsRawFNAvailable, &LocalFNNumBndryConns); if (___2039 && ___2869 && ___2052 != NULL) { if (LocalIsRawFNAvailable) ___2039 = ___17(*___2052, *___2848, ___1303); } if (___2039 && ___2869 && ___1439 != NULL) (*___1439)[*___2848] = LocalFNNumBndryConns; if (___2039                 && ___4682 != NULL && Pass == 2) { ___476(___4677->___2976 == ___333); ArrayListItem_u CurZoneSpecItem; CurZoneSpecItem.___4440 = (void *)___4677; ArrayListSetItem(*___4682, *___2848, CurZoneSpecItem, ___4681, 0); } else { delete ___4677; ___4677 = NULL; } if (___2039) (*___2848)++; if (*___2848 > ___2383) { ___1175(___4218("Exceeding Tecplot's current zone limit of %d. " "Reduce the number of zones being loaded."), ___2383); ___2039 = ___1303; SentError = ___4227; } } else if (___4567 == ___1615) { ___2039 = ___3289(___1399, fileVersion, ___1303, &TempGeom, 5000); if (___2039) { if (Pass == 1) { if (___1819) *___1819 = ___4227; } } } else if (___4567 == ___4113) { ___2039 = ___3294(___1399, fileVersion, ___1303, &TempText, maxTextLength); if (___2039) { if (Pass == 1) { if (___1820) *___1820 = ___4227; } } } else if (___4567 == ___790) { ___372 ___2869; ___2869 = (Pass == 2)                                && ___2793                         && (*___2793 < ___2366) && ___789; ___2039 = ___3287(___1399, fileVersion, ___2869, (___2869 ? &(*___789)[*___2793] : NULL)); if (___2039 && ___2793) (*___2793)++; } else if (___4567 == ___4287) { ___372 ___2869; char     *CurUserRec = NULL; ___2869 = (___372)((Pass == 2) && ___4286); ___2039 = ___3295(___1399, fileVersion, ___2869 ? &CurUserRec : (char **)NULL); if (___2039 && ___2869) ___2039 = ___3824(*___4286, CurUserRec); if (CurUserRec) ___1528(CurUserRec, "temp user rec"); CurUserRec = NULL; } else if (___4567 == ___885) { ___372 ___2869; ___476(fileVersion >= 101);
___2869 = (Pass == 2 && ___884 != NULL); ___2039 = ___3286(___1399, fileVersion, ___2869 ? *___884 : NULL); if (!___2039) { ___1175(___4218("Invalid DATASETAUXDATA record in binary datafile")); SentError = ___4227; } } else if (___4567 == ___4339) { ___372 ___2869; ___2226 ___4336; ___476(fileVersion >= 102); ___2869 = (Pass == 2 && ___4338 != NULL); ___4336 = ___1749<int32_t>(___1399, fileVersion, 0, *NumVars-1, &___2039); if (___2039) { ___264 VarAuxData; if (___2869) { VarAuxData = (___264)___133(*___4338, ___4336); if (VarAuxData == NULL) { VarAuxData = ___231(___263); ___2039 = (VarAuxData != NULL && ___170(*___4338, ___4336, VarAuxData)); } } else VarAuxData = NULL; ___2039 = ___2039 && ___3286(___1399, fileVersion, VarAuxData); if (!___2039) { ___1175(___4218("Invalid VARAUXDATA record in binary datafile")); SentError = ___4227; } } else { ___1175(___4218("Invalid VARAUXDATA variable number association")); SentError = ___4227; } } else ___2039 = ___1303; if (___2039) ___4567 = ___1761(___1399, FieldDataType_Float, 0.0, 1000.0, &___2039); } } } if (___2039 && (*___2848 == 0) && (*NumVars > 0)) { *NumVars = 0; if (___4366 && *___4366) { ___3829(___4366); } } if (!___2039) { if (___4682 && *___4682) ArrayListDealloc(___4682, ___4681, 0); if (___901 && *___901) { ___1528(*___901, "DataSetTitle"); *___901 = NULL; } if (___4366 && *___4366) { ___3829(___4366); } if (___4286 && *___4286) ___3829(___4286); } if ((___884 != NULL && *___884 != NULL) && (!___2039)) ___236(___884); if (!___2039 && !SentError) ___1175(___4218("Invalid header in binary datafile")); ENSURE((___4366 == NULL) || (*___4366 == NULL) || ___3849(*___4366)); ENSURE(IMPLICATION(___4286 != NULL, (*___4286 == NULL || ___3849(*___4286)))); ENSURE(IMPLICATION(___884 != NULL, (*___884 == NULL || VALID_REF(*___884)))); return (___2039); } ___372 ___2877(___1403 **___1399, char const    *___1437, ___1396   ___3687, int32_t       *___2103) { ___372 ___3360 = ___4227; REQUIRE(VALID_REF(___1399)); REQUIRE(*___1399 == NULL); REQUIRE(VALID_REF(___1437)); REQUIRE(___3687 >= 0); REQUIRE(VALID_REF(___2103)); FILE *File = tecplot::filesystem::fileOpen(___1437, "rb"); if (File == NULL) ___3360 = ___1303; if (___3360) { *___1399 = ___1400(File, ___4227); ___3360 = (*___1399 != NULL); } ___3360 = ___3360 && (___4201((*___1399)->File, ___3687, SEEK_SET) == 0); if (___3360) { *___2103 = ___1748(*___1399); ___3360 = (40 <= *___2103 && *___2103 <=  71)  || (*___2103 ==  75)                     || (100 <= *___2103 && *___2103 <= 112) || (*___2103 == 191); ___476(TecplotSDKBinaryFileVersion == 191); } ENSURE(VALID_BOOLEAN(___3360)); return (___3360); }
